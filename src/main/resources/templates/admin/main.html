<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>관리자페이지</title>
    <link rel="stylesheet" th:href="@{/css/admin/admin.css}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div th:replace="~{fragments/common/header :: headerFragment}"></div>
<!--좌측 메뉴-->
<div id="admin-body">
    <div class="admin-sidebar">
        <h3>관리자 메뉴</h3>
        <ul>
            <li><a th:href="@{/admin}">관리자 페이지 홈</a></li>
            <li><a th:href="@{/admin/markets}">시장 관리</a></li>
            <li><a th:href="@{/admin/shops}">상점 관리</a></li>
            <li><a th:href="@{/admin/items}">상품 관리</a></li>
            <li><a th:href="@{/admin/members}">회원 관리</a></li>
            <li><a th:href="@{/admin/inquiries}">문의사항 관리</a></li>
            <li><a th:href="@{/admin/notices}">공지사항 관리</a></li>
            <li><a th:href="@{/admin/visitor}">방문자 수</a></li>
        </ul>
    </div>
    <!--주 내용-->
    <div class="admin-contents">
        <h2>관리자페이지입니다</h2>
        <p>총 회원 수: <span id="totalMembers">로딩 중...</span></p>
        <p>총 시장 수: <span id="totalMarkets">로딩 중...</span></p>
        <p>총 상점 수: <span id="totalShops">로딩 중...</span></p>

        <!-- 시장 선택 드롭다운 및 상점 수 표시 -->
        <div>
            <label for="marketSelect">시장 선택:</label>
            <select id="marketSelect">
                <option value="">-- 선택하세요 --</option>
            </select>
        </div>
        <p>선택한 시장의 상점 수: <span id="marketShopCount">로딩 중...</span></p>
    </div>
</div>
<script>
    $(document).ready(function() {
        // 총 회원 수
        $.ajax({
            url: '/api/members/admin/count',
            method: 'GET',
            success: function(response) {
                $('#totalMembers').text(response);
            },
            error: function(xhr, status, error) {
                console.error('총 회원 수를 가져오는 데 실패했습니다.', error);
            }
        });

        // 총 시장 수
        $.ajax({
            url: '/api/admin/markets/count',
            method: 'GET',
            success: function(response) {
                $('#totalMarkets').text(response);
            },
            error: function(xhr, status, error) {
                console.error('총 시장 수를 가져오는 데 실패했습니다.', error);
            }
        });

        // 총 상점 수
        $.ajax({
            url: '/api/admin/shops/count',
            method: 'GET',
            success: function(response) {
                $('#totalShops').text(response);
            },
            error: function(xhr, status, error) {
                console.error('총 상점 수를 가져오는 데 실패했습니다.', error);
            }
        });

        // 시장 목록 로드 및 드롭다운에 채우기
        $.ajax({
            url: '/api/markets',
            method: 'GET',
            success: function(markets) {
                const marketSelect = $('#marketSelect');
                markets.content.forEach(function(market) {
                    marketSelect.append(
                        $('<option></option>').val(market.marketNo).text(market.marketName)
                    );
                });
            },
            error: function(xhr, status, error) {
                console.error('시장 목록을 가져오는 데 실패했습니다.', error);
            }
        });

        // 드롭다운 변경 이벤트 처리
        $('#marketSelect').on('change', function() {
            const marketNo = $(this).val();
            if (marketNo) {
                // 시장별 상점 수 요청
                $.ajax({
                    url: `/api/admin/${marketNo}/shops/count`,
                    method: 'GET',
                    success: function(response) {
                        $('#marketShopCount').text(response);
                    },
                    error: function(xhr, status, error) {
                        console.error('시장별 상점 수를 가져오는 데 실패했습니다.', error);
                        $('#marketShopCount').text('조회 실패');
                    }
                });
            } else {
                $('#marketShopCount').text('선택된 시장 없음');
            }
        });
    });
</script>
<!--<div th:replace="~{fragments/common/footer :: footerFragment}"></div>-->
</body>
</html>

